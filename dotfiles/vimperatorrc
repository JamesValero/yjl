colorscheme vimPgray

set defsearch=g
set guioptions=rb

" Remove all key mappings
mapclear

map <F8> :set guioptions!=B<CR>
map <F9> :set guioptions!=m<CR>
map <F10> :set guioptions!=T<CR>

" Tab order rearragement
map <C-S-PageUp> :tabm -1<CR>
map <C-S-PageDown> :tabm +1<CR>

" I hate when I want to press <C-w> but I hit q instead
map <C-q> <Nop>

" Clean up all auto commands
:autocmd!

:js << EOF
function itch(url) {
	var msg = '';
	if (url.indexOf('mail.google.com') != -1) {
		msg = 'Reading emails';
		}
	else if (url.indexOf('www.google.com/reader/') != -1) {
		msg = 'Reading feeds';
		}
	else if (url.indexOf('flickr.com') != -1) {
		msg = 'Wandering on Flickr';
		}
	if (!!msg)
		io.system('itch.sh "' + msg + '"');
	}

switch (liberator.profileName) {
	case 'Normal':
		// Enter passthrough mode automatically in Gmail, Reader
		liberator.execute('autocmd LocationChange .* js modes.passAllKeys = /((mail|groups)\\.google\\.com|www\\.google\\.com\\/reader\\/)/.test(buffer.URL)');

		// Auto reload
		liberator.execute('autocmd PageLoad tw\\\\.finance\\\\.yahoo.com\\\\/pf\\\\/mypf js (function(){var t=getBrowser().tabs[<tab>-1];if (!t.pinned) getBrowser().pinTab(t);window.setTimeout(function(){getBrowser().reloadTab(t)},60000)})()');

		// Auto-pin
		liberator.execute('autocmd PageLoad listen.grooveshark.com js if(!getBrowser().mCurrentTab.pinned) getBrowser().pinTab(getBrowser().mCurrentTab);');

		// ItchApe
		liberator.execute('autocmd PageLoad .* js itch("<url>")');
		break;
	case 'Test':
		// Make command line red
		for ([k, v] in Iterator(highlight)) {
			highlight.set(k, highlight.get(k).value.replace('background: #333', 'background: #633'));
			}
		// Source special config
		io.source('~/.vimperator-Test.rc', false);
		break;
	}
// PageLoad isn't fired when browser is launched
if (getBrowser().contentDocument.location.href == 'about:blank')
	getBrowser().contentDocument.body.style.backgroundColor = "#333";
EOF

autocmd PageLoad about:blank js tabs.getTab(<tab>-1).linkedBrowser.contentDocument.body.style.backgroundColor = "#333"
