colorscheme vimPgray

set defsearch=g
set guioptions=rb

" Remove all key mappings
mapclear

map <F8> :set guioptions!=B<CR>
map <F9> :set guioptions!=m<CR>
map <F10> :set guioptions!=T<CR>

" Tab order rearragement
map <C-S-PageUp> :tabm -1<CR>
map <C-S-PageDown> :tabm +1<CR>

" I hate when I want to press <C-w> but I hit q instead
map <C-q> <Nop>

" Clean up all auto commands
:autocmd!

:js << EOF
function replace_gdic_flash() {
	var doc = getBrowser().contentDocument;
	var flashes = doc.getElementsByTagName('object');
	var idx = 0;
	while (idx<flashes.length) {
		var f = flashes[idx];
		var a = f.getElementsByTagName('a');
		if (a.length != 1) {
			idx++;
			continue;
			}
		a = a[0];
		a.audiosrc = a.href;
		a.href = '#';
		a.addEventListener('click', function() {
			liberator.echomsg('Playing ' + this.audiosrc);
			io.system('mplayer ' + this.audiosrc);
			liberator.echomsg(this.audiosrc + ' played');
			}, false);
		f.parentNode.replaceChild(a, f);
		}
	}

function play_gdic_default() {
	var doc = getBrowser().contentDocument;
	if (!/www\.google\.com\/dictionary/.test(doc.location.href)) {
		liberator.echoerr('Not Google Dictionary page');
		return;
		}
	var audios = doc.getElementsByTagName('a');
	for (var idx in audios) {
		var a = audios[parseInt(idx)];
		if (!a.audiosrc)
			continue;
		liberator.echomsg('Playing ' + a.audiosrc);
		io.system('mplayer ' + a.audiosrc);
		liberator.echomsg(a.audiosrc + ' played');
		break;
		}
	}

switch (liberator.profileName) {
	case 'Normal':
		// Enter passthrough mode automatically in Gmail, Reader
		liberator.execute('autocmd LocationChange .* js modes.passAllKeys = /((mail|groups)\\.google\\.com|www\\.google\\.com\\/reader\\/)/.test(buffer.URL)');

		// Auto reload
		liberator.execute('autocmd PageLoad tw\\\\.finance\\\\.yahoo.com\\\\/pf\\\\/mypf js (function(){var t=getBrowser().tabs[<tab>-1];if (!t.pinned) getBrowser().pinTab(t);window.setTimeout(function(){getBrowser().reloadTab(t)},60000)})()');

		// Auto-pin
		liberator.execute('autocmd PageLoad listen.grooveshark.com js if(!getBrowser().mCurrentTab.pinned) getBrowser().pinTab(getBrowser().mCurrentTab);');

		// Auto-queue YouTube video for downloading
		liberator.execute('map <S-q> :js (function(){var href=getBrowser().contentDocument.location.href; if(href.indexOf("youtube.com")>=0) {var m=/v=([-_a-zA-Z0-9]+)/.exec(href);if(m) {io.system(\'echo "\'+href+\'" \\> ~/Videos/livibetter/queue/\'+m[1]); commandline.echo(m[1]+" queued.");}};})()<CR>');
		break;
	case 'Test':
		// Make command line red
		for ([k, v] in Iterator(highlight)) {
			highlight.set(k, highlight.get(k).value.replace('background: #333', 'background: #633'));
			}
		// Source special config
		io.source('~/.vimperator-Test.rc', false);
		break;
	}
EOF

autocmd PageLoad about:blank js getBrowser().contentDocument.body.style.backgroundColor = "#333"
autocmd PageLoad www\\.google\\.com\\/dictionary js replace_gdic_flash();
map s :js play_gdic_default()<CR>
