colorscheme vimPgray

set defsearch=g
set gui=none,tabs

" Remove all key mappings
mapclear

map <F8> :set gui=all<CR>
map <F9> :set gui=none,tabs<CR>

" Tab order rearragement
map <C-S-PageUp> :tabm -1<CR>
map <C-S-PageDown> :tabm +1<CR>

" I hate when I want to press <C-w> but I hit q instead
map <C-q> <Nop>

" Clean up all auto commands
:autocmd!

:js << EOF
function itch(url) {
	var msg = '';
	if (url.indexOf('mail.google.com') != -1) {
		msg = 'Reading emails';
		}
	else if (url.indexOf('www.google.com/reader/') != -1) {
		msg = 'Reading feeds';
		}
	else if (url.indexOf('flickr.com') != -1) {
		msg = 'Wandering on Flickr';
		}
	else if (url.indexOf('youtube.com') != -1) {
		msg = 'Could be lost 1 minute and 30 seconds of my life or having a great time on YouTube...';
		}
	if (!!msg)
		io.system('itch.sh "' + msg + '"');
	}

function fix_yt_home(tab) {
	var d = tabs.getTab(tab - 1).linkedBrowser.contentDocument;
	var target_sideblock_ids = ['feedmodule-TOP', 'homepage-side-content'];
	for (idx in target_sideblock_ids) {
		var id = target_sideblock_ids[idx];
		var target = d.getElementById(id);
		target.parentNode.removeChild(target);
		}
	var s = d.createElement('style');
	s.innerHTML = '\
#homepage-main-content {\
	width: 970px;\
	margin-right: 0;\
	}\
.see-more-videos-from-aggregate-feeditem {\
	margin-right: 0;\
	}\
.feedmodule-item-with-x {\
	width: 16%;\
	}\
'
	d.getElementsByTagName('head')[0].appendChild(s);
	}

switch (liberator.profileName) {
	case 'Normal':
		// Enter passthrough mode automatically in Gmail, Reader
		liberator.execute('autocmd LocationChange .* js modes.passAllKeys = /((mail|groups)\\.google\\.com|www\\.google\\.com\\/reader\\/)/.test(buffer.URL)');

		// Auto reload
		liberator.execute('autocmd PageLoad tw\\\\.finance\\\\.yahoo.com\\\\/pf\\\\/mypf js (function(){var t=getBrowser().tabs[<tab>-1];if (!t.pinned) getBrowser().pinTab(t);window.setTimeout(function(){getBrowser().reloadTab(t)},60000)})()');

		// Auto-pin
		liberator.execute('autocmd PageLoad listen.grooveshark.com js if(!getBrowser().mCurrentTab.pinned) getBrowser().pinTab(getBrowser().mCurrentTab);');

		// ItchApe
		liberator.execute('autocmd PageLoad .* js itch("<url>")');

		// Fix damn YouTube
		liberator.execute('autocmd DOMLoad www\\\\.youtube\\\\.com\\\\/$ js fix_yt_home(<tab>)');
		liberator.execute('autocmd PageLoad www\\\\.youtube\\\\.com\\\\/$ js tabs.getTab(<tab> - 1).linkedBrowser.contentDocument.getElementById("masthead-search-term").blur()');
		break;
	case 'Test':
		// Make command line red
		for ([k, v] in Iterator(highlight)) {
			highlight.set(k, highlight.get(k).value.replace('background: #333', 'background: #633'));
			}
		// Source special config
		io.source('~/.vimperator-Test.rc', false);
		break;
	}
// PageLoad isn't fired when browser is launched
if (getBrowser().contentDocument.location.href == 'about:blank')
	getBrowser().contentDocument.body.style.backgroundColor = "#333";
EOF

autocmd PageLoad about:blank js tabs.getTab(<tab>-1).linkedBrowser.contentDocument.body.style.backgroundColor = "#333"
